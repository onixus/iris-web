<!DOCTYPE html>
<html lang="en">
<head>

	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>IRIS - {% block title %}Case{% endblock %} {% if session['current_case'].case_id %}| {{ session['current_case'].case_name }}  {% endif %} </title>
	<meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
	<link rel="icon" href="/static/assets/img/logo.ico" type="image/x-icon"/>
	{% if demo_domain %}
		<script defer data-domain="{{demo_domain}}" src="https://analytics.dfir-iris.org/js/plausible.js"></script>
	{% endif %}
	<!-- Fonts and icons -->
	<script src="/static/assets/js/plugin/webfont/webfont.min.js"></script>
	<script>
		WebFont.load({
			custom: {"families":["Lato:300,400,700,900", "Flaticon", "Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"],
			urls: ['/static/assets/css/fonts.css']},
			active: function() {
				sessionStorage.fonts = true;
			}
		});
	</script>

	<!-- CSS Files -->
	<link rel="stylesheet" href="/static/assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/assets/css/atlantis.css">
	<link rel="stylesheet" href="/static/assets/css/suggestags.css">
	<link rel="stylesheet" href="/static/assets/css/bootstrap-select.min.css">

    <!-- Specific CSS goes HERE -->
    {% block stylesheets %}{% endblock stylesheets %}

	{% set _theme = current_user.effective_theme if current_user.is_authenticated else 'light' %}

	<!-- Theme CSS -->
	{% if _theme == 'dark' %}
		<link rel="stylesheet" href="/static/assets/css/dark-theme.css" id="iris-theme-css">
	{% elif _theme == 'pride' %}
		<link rel="stylesheet" href="/static/assets/css/pride-theme.css" id="iris-theme-css">
	{% else %}
		<link rel="stylesheet" href="" id="iris-theme-css"><!-- light: no extra CSS -->
	{% endif %}

	<style>
		.iris-locale-btn.active, .iris-theme-btn.active {
			border-color: rgba(255,255,255,0.9) !important;
			color: #fff !important;
			background: rgba(255,255,255,0.15) !important;
			font-weight: 700;
		}
	</style>
</head>
<body class="theme-{{ _theme }}">
	<div class="wrapper {% block layout %}{% endblock layout %} {% include 'includes/sidebar_handler.html' %}">

		{% block content %}{% endblock content %}

		{% include 'includes/quick-sidebar.html' %}
		{% include 'includes/datastore-sidebar.html' %}
		<div id="minimized_modal_box" class="col-10 col-xs-11 col-sm-4 minimized_modal shadow-lg" style="display:none;" title="Maximize modal" onclick="modal_maximize();">
			<div class="row mt-3 mb-3">
				<div class="col-10 d-flex">
					<span data-notify="title" id="minimized_modal_title" class="align-self-center"></span>
				</div>
				<div class="col-1 d-flex" style="padding-left:5px;">
					<i class="fa-solid fa-arrow-up-right-dots align-self-center"></i>
				</div>
			</div>
		</div>
		<div id="modal_md_helper"></div>
	</div>

	<!--   Core JS Files   -->
	<script src="/static/assets/js/core/jquery.3.2.1.min.js"></script>
	<script src="/static/assets/js/core/popper.min.js"></script>
	<script src="/static/assets/js/core/bootstrap.min.js"></script>
	<script src="/static/assets/js/plugin/tagsinput/suggesttag.js"></script>

	<!-- jQuery UI -->
	<script src="/static/assets/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
	<script src="/static/assets/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>

	<!-- jQuery Scrollbar -->
	<script src="/static/assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>

	<!-- Datatables -->
	<script src="/static/assets/js/plugin/datatables/datatables.min.js"></script>

	<!-- Bootstrap Notify -->
	<script src="/static/assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>
	<script src="/static/assets/js/plugin/sweetalert/sweetalert.min.js"></script>
	<script src="/static/assets/js/plugin/select/bootstrap-select.min.js"></script>
	<script src="/static/assets/js/plugin/select/ajax-bootstrap-picker.js"></script>

	<!-- HTML 2 Canvas -->
	<script src="/static/assets/js/plugin/html2canvas/html2canvas.min.js"></script>

	<!-- Atlantis JS -->
	<script src="/static/assets/js/atlantis.min.js"></script>

	<script src="/static/assets/js/plugin/ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
	<script src="/static/assets/js/plugin/ace/src-noconflict/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>

	<!-- IRIS i18n INLINE (static volume is read-only, cannot use external file) -->
	<script>
(function(global){'use strict';var STORAGE_KEY='iris_locale';var LOCALES={en:{nav:{dashboard:'Dashboard',cases:'Cases',alerts:'Alerts',search:'Search',datastore:'Datastore',activities:'Activities',manage:'Manage',logout:'Logout',profile:'My profile',mySettings:'My settings',overview:'Overview',welcome:'Welcome page',investigation:'Investigation',case:'Case',dimTasks:'DIM Tasks',manageCases:'Manage cases',advanced:'Advanced',help:'Help',updatesAvailable:'Updates are available for the server'},manage:{title:'Administration',users:'Users',groups:'Groups',customers:'Customers',modules:'Modules',objects:'Case Objects',attributes:'Custom Attributes',templates:'Report Templates',caseTemplates:'Case Templates',serverSettings:'Server settings',accessControl:'Access control',audit:'Audit'},cases:{title:'Cases',newCase:'New case',id:'Case #',name:'Name',status:'Status',classification:'Classification',owner:'Owner',customer:'Customer',openedAt:'Opened',closedAt:'Closed',severity:'Severity',tlp:'TLP',pap:'PAP',summary:'Summary',tasks:'Tasks',timeline:'Timeline',ioc:'IOC',assets:'Assets',notes:'Notes',evidence:'Evidence',graph:'Graph',pipelines:'Pipelines',manage:'Manage',processors:'Processors',requestReview:'Request review',generateReport:'Generate report',activityReport:'Activity report'},alerts:{title:'Alerts',id:'Alert ID',title_col:'Title',source:'Source',status:'Status',severity:'Severity',classification:'Classification',owner:'Owner',customer:'Customer',createdAt:'Created',updatedAt:'Updated',merge:'Merge into case',escalate:'Escalate',dismiss:'Dismiss'},tasks:{title:'Tasks',name:'Task name',status:'Status',assignee:'Assignee',addedAt:'Added',dueDate:'Due date',addTask:'Add task',statusOpen:'Open',statusDone:'Done',statusInProg:'In progress',statusToDo:'To-do'},timeline:{title:'Timeline',addEvent:'Add event',eventDate:'Date',eventTitle:'Title',eventCategory:'Category',eventColor:'Color',eventRaw:'Raw event'},notes:{title:'Notes',newGroup:'New group',newNote:'New note',untitled:'Untitled'},ioc:{title:'Indicators of Compromise',value:'Value',type:'Type',tlp:'TLP',description:'Description',addIoc:'Add IOC',importIoc:'Import IOC',enrichIoc:'Enrich',deleteIoc:'Delete'},assets:{title:'Assets',name:'Name',type:'Type',ip:'IP / Hostname',description:'Description',compromised:'Compromised',addAsset:'Add asset',importAssets:'Import assets'},datastore:{title:'Datastore',upload:'Upload file',fileName:'File name',size:'Size',uploadedBy:'Uploaded by',uploadedAt:'Uploaded at',download:'Download',delete:'Delete'},dashboard:{title:'Dashboard',openCases:'Open cases',closedCases:'Closed cases',openAlerts:'Open alerts',recentActivity:'Recent activity',casesOverTime:'Cases over time',severityDist:'Severity distribution'},common:{save:'Save',cancel:'Cancel',delete:'Delete',edit:'Edit',add:'Add',close:'Close',confirm:'Confirm',loading:'Loading…',error:'Error',success:'Success',warning:'Warning',noData:'No data available',search:'Search…',actions:'Actions',yes:'Yes',no:'No',createdAt:'Created at',updatedAt:'Updated at',description:'Description',name:'Name',type:'Type',status:'Status',unknown:'Unknown',copy:'Copy',export:'Export',import:'Import',refresh:'Refresh',filter:'Filter',rows:'{{count}} rows',page:'Page {{current}} of {{total}}'},auth:{login:'Sign in',logout:'Sign out',username:'Username',password:'Password',forgotPassword:'Forgot password?',loginFailed:'Invalid credentials',mfa:'Two-factor code',loginBtn:'Sign in'},severity:{unspecified:'Unspecified',informational:'Informational',low:'Low',medium:'Medium',high:'High',critical:'Critical'},tlp:{white:'TLP:WHITE',green:'TLP:GREEN',amber:'TLP:AMBER',red:'TLP:RED'}},ru:{nav:{dashboard:'Дашборд',cases:'Инциденты',alerts:'Алерты',search:'Поиск',datastore:'Хранилище',activities:'Активность',manage:'Управление',logout:'Выйти',profile:'Мой профиль',mySettings:'Мои настройки',overview:'Обзор',welcome:'Начальная страница',investigation:'Расследование',case:'Инцидент',dimTasks:'Задачи DIM',manageCases:'Управление инцидентами',advanced:'Расширенные',help:'Помощь',updatesAvailable:'Доступны обновления сервера'},manage:{title:'Администрирование',users:'Пользователи',groups:'Группы',customers:'Клиенты',modules:'Модули',objects:'Объекты инцидента',attributes:'Пользовательские атрибуты',templates:'Шаблоны отчётов',caseTemplates:'Шаблоны инцидентов',serverSettings:'Настройки сервера',accessControl:'Управление доступом',audit:'Аудит'},cases:{title:'Инциденты',newCase:'Новый инцидент',id:'Инцидент №',name:'Название',status:'Статус',classification:'Классификация',owner:'Ответственный',customer:'Клиент',openedAt:'Открыт',closedAt:'Закрыт',severity:'Серьёзность',tlp:'TLP',pap:'PAP',summary:'Сводка',tasks:'Задачи',timeline:'Хронология',ioc:'Индикаторы',assets:'Активы',notes:'Заметки',evidence:'Доказательства',graph:'Граф',pipelines:'Пайплайны',manage:'Управлять',processors:'Процессоры',requestReview:'Запросить проверку',generateReport:'Создать отчёт',activityReport:'Отчёт активности'},alerts:{title:'Алерты',id:'ID алерта',title_col:'Заголовок',source:'Источник',status:'Статус',severity:'Серьёзность',classification:'Классификация',owner:'Ответственный',customer:'Клиент',createdAt:'Создан',updatedAt:'Обновлён',merge:'Слить в инцидент',escalate:'Эскалировать',dismiss:'Отклонить'},tasks:{title:'Задачи',name:'Название задачи',status:'Статус',assignee:'Исполнитель',addedAt:'Добавлена',dueDate:'Срок',addTask:'Добавить задачу',statusOpen:'Открыта',statusDone:'Выполнена',statusInProg:'В работе',statusToDo:'Запланирована'},timeline:{title:'Хронология',addEvent:'Добавить событие',eventDate:'Дата',eventTitle:'Заголовок',eventCategory:'Категория',eventColor:'Цвет',eventRaw:'Сырое событие'},notes:{title:'Заметки',newGroup:'Новая группа',newNote:'Новая заметка',untitled:'Без названия'},ioc:{title:'Индикаторы компрометации',value:'Значение',type:'Тип',tlp:'TLP',description:'Описание',addIoc:'Добавить IOC',importIoc:'Импорт IOC',enrichIoc:'Обогатить',deleteIoc:'Удалить'},assets:{title:'Активы',name:'Название',type:'Тип',ip:'IP / Имя хоста',description:'Описание',compromised:'Скомпрометирован',addAsset:'Добавить актив',importAssets:'Импорт активов'},datastore:{title:'Хранилище файлов',upload:'Загрузить файл',fileName:'Имя файла',size:'Размер',uploadedBy:'Загружен пользователем',uploadedAt:'Дата загрузки',download:'Скачать',delete:'Удалить'},dashboard:{title:'Дашборд',openCases:'Открытых инцидентов',closedCases:'Закрытых инцидентов',openAlerts:'Открытых алертов',recentActivity:'Последняя активность',casesOverTime:'Динамика инцидентов',severityDist:'Распределение по серьёзности'},common:{save:'Сохранить',cancel:'Отмена',delete:'Удалить',edit:'Редактировать',add:'Добавить',close:'Закрыть',confirm:'Подтвердить',loading:'Загрузка…',error:'Ошибка',success:'Успешно',warning:'Предупреждение',noData:'Нет данных',search:'Поиск…',actions:'Действия',yes:'Да',no:'Нет',createdAt:'Создано',updatedAt:'Обновлено',description:'Описание',name:'Название',type:'Тип',status:'Статус',unknown:'Неизвестно',copy:'Копировать',export:'Экспорт',import:'Импорт',refresh:'Обновить',filter:'Фильтр',rows:'{{count}} записей',page:'Страница {{current}} из {{total}}'},auth:{login:'Войти',logout:'Выйти',username:'Имя пользователя',password:'Пароль',forgotPassword:'Забыли пароль?',loginFailed:'Неверные учётные данные',mfa:'Код 2FA',loginBtn:'Войти'},severity:{unspecified:'Не указана',informational:'Информационная',low:'Низкая',medium:'Средняя',high:'Высокая',critical:'Критическая'},tlp:{white:'TLP:БЕЛЫЙ',green:'TLP:ЗЕЛЁНЫЙ',amber:'TLP:ЯНТАРНЫЙ',red:'TLP:КРАСНЫЙ'}}};function resolve(obj,key){return key.split('.').reduce(function(o,k){return(o&&typeof o==='object')?o[k]:undefined;},obj);}function interpolate(str,vars){if(!vars)return str;return str.replace(/\{\{(\w+)\}\}/g,function(_,k){return(vars[k]!==undefined)?vars[k]:'{{'+k+'}}';});}var currentLocale=(typeof localStorage!=='undefined'&&localStorage.getItem(STORAGE_KEY))||'en';function t(key,vars){var lang=LOCALES[currentLocale]||LOCALES['en'];var text=resolve(lang,key)||resolve(LOCALES['en'],key)||key;return interpolate(text,vars);}function setLocale(lang){if(!LOCALES[lang]){console.warn('[i18n] Unknown locale: '+lang);return;}currentLocale=lang;if(typeof localStorage!=='undefined'){localStorage.setItem(STORAGE_KEY,lang);}document.documentElement.setAttribute('lang',lang);applyToDOM();if(typeof $!=='undefined'&&$.fn&&$.fn.DataTable){try{$.fn.DataTable.tables({visible:true,api:true}).draw(false);}catch(_){}}document.querySelectorAll('.iris-locale-btn').forEach(function(btn){btn.classList.toggle('active',btn.dataset.locale===lang);});}function applyToDOM(){document.querySelectorAll('[data-i18n]').forEach(function(el){el.textContent=t(el.getAttribute('data-i18n'));});document.querySelectorAll('[data-i18n-placeholder]').forEach(function(el){el.placeholder=t(el.getAttribute('data-i18n-placeholder'));});document.querySelectorAll('[data-i18n-title]').forEach(function(el){el.title=t(el.getAttribute('data-i18n-title'));});var titleMeta=document.querySelector('[data-i18n-page-title]');if(titleMeta){var suffix=titleMeta.getAttribute('data-i18n-page-title-suffix')||'';document.title=t(titleMeta.getAttribute('data-i18n-page-title'))+(suffix?' | '+suffix:'');}}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',applyToDOM);}else{applyToDOM();}global.iris_t=t;global.iris_set_locale=setLocale;global.iris_locale=function(){return currentLocale;};global.IRIS_LOCALES=LOCALES;}(window));
		// Init locale
		(function(){
			var saved=localStorage.getItem('iris_locale')||'en';
			document.documentElement.setAttribute('lang',saved);
			document.addEventListener('DOMContentLoaded',function(){
				document.querySelectorAll('.iris-locale-btn').forEach(function(btn){
					btn.classList.toggle('active',btn.dataset.locale===saved);
				});
			});
		}());
	</script>

	<script src="/static/assets/js/iris/common.js"></script>
	<script src="/static/assets/js/iris/datastore.js"></script>

	<script src="/static/assets/js/core/crypto.core.js"></script>
	<script src="/static/assets/js/core/crypto.md5.js"></script>
	<script src="/static/assets/js/plugin/xss/xss.js"></script>
	<script src="/static/assets/js/plugin/showdown/showdown.min.js" type="text/javascript" charset="utf-8"></script>

	<!-- Theme switcher JS -->
	<script>
		var IRIS_CURRENT_THEME = '{{ _theme }}';
		var THEME_CSS = {light:'',dark:'/static/assets/css/dark-theme.css',pride:'/static/assets/css/pride-theme.css'};
		function iris_set_theme(theme){
			if(!THEME_CSS.hasOwnProperty(theme))return;
			document.getElementById('iris-theme-css').href=THEME_CSS[theme];
			document.body.classList.remove('theme-light','theme-dark','theme-pride');
			document.body.classList.add('theme-'+theme);
			document.querySelectorAll('.iris-theme-btn').forEach(function(btn){btn.classList.toggle('active',btn.dataset.theme===theme);});
			IRIS_CURRENT_THEME=theme;
			$.ajax({url:'/profile/theme',type:'POST',contentType:'application/json',data:JSON.stringify({theme:theme}),error:function(){console.warn('[theme] Failed to save theme preference');}});
		}
		document.addEventListener('DOMContentLoaded',function(){
			document.querySelectorAll('.iris-theme-btn').forEach(function(btn){btn.classList.toggle('active',btn.dataset.theme===IRIS_CURRENT_THEME);});
		});
	</script>

	<!-- Specific JS goes HERE -->
    {% block javascripts %}{% endblock javascripts %}
	
</body>
</html>